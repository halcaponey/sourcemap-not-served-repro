{"version":3,"file":"scoped-style.js","sources":["src/utils.js","src/index.js"],"sourcesContent":["var pseudoSelectorRegex = /(,?(\\s*(::?|(>|~|\\+)\\s?)(\\w|-|_|\\.|#|\\*|\\[([^\\[\\]])*\\]|\\(([^\\(\\)])+\\))+)+\\s*)+\\{\\W*[!:;#%\\/\\\\\\.\\(\\)\\+,\\s\\w\"'-]+\\}/gm;\r\nvar atRuleRegex = /@.*\\{\\W*([!:;#%\\/\\.\\(\\)\\+,\\s\\w\"'-]|(,?(\\s*(::?|(>|~|\\+)\\s?)(\\w|-|_|\\.|#|\\*|\\[([^\\[\\]])*\\]|\\(([^\\(\\)])+\\))+)+\\s*)+\\{\\W*[!:;#%\\/\\\\\\.\\(\\)\\+,\\s\\w\"'-]+\\})+\\}/gm;\r\nvar globalRuleRegex = /(\\w|\\s|:|>|~|\\+|-|_|#|\\.|\\[([^\\[\\]])*\\]|\\*|,|\\(([^\\(\\)])+\\))+\\{\\W*[!:;#%\\/\\\\\\.\\(\\)\\+,\\s\\w\"'-]+\\}/gm;\r\nvar globalAtRuleRegex = /@.*\\{\\W*((\\w|\\s|:|>|~|\\+|-|_|#|\\.|\\[([^\\[\\]])*\\]|\\*|,|\\(([^\\(\\)])+\\))+\\{\\W*[!:;#%\\/\\\\\\.\\(\\)\\+,\\s\\w\"'-]+\\})+\\s*\\}/gm;\r\nvar bodyRuleRegex = /\\{\\W*[!:;#%\\/\\\\\\.\\(\\)\\+,\\s\\w\"'-]+\\}/gm;\r\nvar commentRegex = /\\/\\*.*\\*\\//gm;\r\nvar testClassNamesIDCount = 0;\r\n\r\nexport function mainRule(styles, classID) {\r\n  return (\r\n    '.' +\r\n    classID +\r\n    '{' +\r\n    styles\r\n      .replace(commentRegex, '')\r\n      .replace(atRuleRegex, '')\r\n      .replace(pseudoSelectorRegex, '') +\r\n    '}'\r\n  );\r\n}\r\n\r\nexport function pseudoSelectorRules(styles, classID) {\r\n  var rules = [];\r\n  var matches =\r\n    styles\r\n      .replace(commentRegex, '')\r\n      .replace(atRuleRegex, '')\r\n      .match(pseudoSelectorRegex) || [];\r\n  for (var index = 0; index < matches.length; index++) {\r\n    var ruleBody = matches[index].match(bodyRuleRegex)[0];\r\n    var pseudoSelectors = matches[index].replace(bodyRuleRegex, '').split(',');\r\n    for (var j = 0; j < pseudoSelectors.length; j++) {\r\n      rules.push('.' + classID + pseudoSelectors[j].trim() + ruleBody);\r\n    }\r\n  }\r\n  return rules;\r\n}\r\n\r\nexport function atRules(styles, classID) {\r\n  var atrules = [];\r\n  var matches = styles.replace(commentRegex, '').match(atRuleRegex) || [];\r\n  for (var index = 0; index < matches.length; index++) {\r\n    var body = (matches[index].replace(pseudoSelectorRegex, '').match(bodyRuleRegex) || [''])[0];\r\n    var rules = body.replace(/[\\s\\{\\}]*/gm, '') !== '' ? '.' + classID + body : '';\r\n    var pseudoSelectorMatches = matches[index].match(pseudoSelectorRegex) || [];\r\n    for (var j = 0; j < pseudoSelectorMatches.length; j++) {\r\n      var ruleBody = pseudoSelectorMatches[j].match(bodyRuleRegex)[0];\r\n      var pseudoSelectors = pseudoSelectorMatches[j].replace(bodyRuleRegex, '').split(',');\r\n      for (var k = 0; k < pseudoSelectors.length; k++) {\r\n        rules += '.' + classID + pseudoSelectors[k].trim() + ruleBody;\r\n      }\r\n    }\r\n    atrules.push(matches[index].match(/@.*/) + rules + '}');\r\n  }\r\n  return atrules;\r\n}\r\n\r\nexport function globalRules(styles) {\r\n  return (styles.replace(commentRegex, '').match(globalAtRuleRegex) || []).concat(\r\n    styles\r\n      .replace(commentRegex, '')\r\n      .replace(globalAtRuleRegex, '')\r\n      .match(globalRuleRegex) || []\r\n  );\r\n}\r\n\r\nexport function generateID() {\r\n  var charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\n  var randomString = '';\r\n  for (var i = 0; i < 7; i++) {\r\n    var randomPoz = Math.floor(Math.random() * charSet.length);\r\n    randomString += charSet.substring(randomPoz, randomPoz + 1);\r\n  }\r\n  return randomString;\r\n}\r\n\r\nfunction ruleAlreadyExist(classID, rule, rulesForComponent) {\r\n  var objkeysRulesForComponent = Object.keys(rulesForComponent);\r\n  for (var index = 0; index < objkeysRulesForComponent.length; index++) {\r\n    for (var j = 0; j < rulesForComponent[objkeysRulesForComponent[index]].length; j++) {\r\n      if (\r\n        rulesForComponent[objkeysRulesForComponent[index]][j].replace(\r\n          objkeysRulesForComponent[index],\r\n          classID\r\n        ) === rule\r\n      ) {\r\n        return objkeysRulesForComponent[index];\r\n      }\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function insertStyleAndSetclassIDs(classID, rule, rulesForComponent, classIDs, cb) {\r\n  var nameRuleAlreadyExist = ruleAlreadyExist(classID, rule, rulesForComponent);\r\n  if (!nameRuleAlreadyExist) {\r\n    cb(rule);\r\n    if (!rulesForComponent[classID]) {\r\n      rulesForComponent[classID] = [];\r\n    }\r\n    rulesForComponent[classID].push(rule);\r\n    if (classIDs.indexOf(classID) === -1) {\r\n      classIDs.push(classID);\r\n    }\r\n  } else {\r\n    if (classIDs.indexOf(nameRuleAlreadyExist) === -1) {\r\n      classIDs.push(nameRuleAlreadyExist);\r\n    }\r\n  }\r\n}\r\n\r\nexport function isTestEnvironment() {\r\n  if (typeof process !== 'undefined') {\r\n    return process.env.NODE_ENV === 'test';\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function generateIDForTests() {\r\n  return 'c' + testClassNamesIDCount++;\r\n}\r\n","import {\r\n  mainRule,\r\n  pseudoSelectorRules,\r\n  atRules,\r\n  globalRules,\r\n  generateID,\r\n  generateIDForTests,\r\n  insertStyleAndSetclassIDs,\r\n  isTestEnvironment,\r\n} from './utils';\r\n\r\nvar sheet =\r\n  typeof document === 'undefined'\r\n    ? { insertRule: function() {} }\r\n    : document.head.appendChild(document.createElement('style')).sheet;\r\n\r\nfunction defaultcb(css) {\r\n  sheet.insertRule(css, sheet.cssRules ? sheet.cssRules.length : 0);\r\n}\r\n\r\nfunction scoped(h, cb) {\r\n  cb = cb || defaultcb;\r\n  function styled(elem) {\r\n    return function(tags) {\r\n      var fns = [].slice.call(arguments);\r\n      fns.shift();\r\n      var rulesForComponent = {};\r\n      return function(props, children) {\r\n        var classID = scoped.generateID();\r\n        rulesForComponent[classID] = [];\r\n        var classIDs = [];\r\n        children = Array.isArray(children) ? children : props.children;\r\n        var styles = '';\r\n        for (var index = 0; index < tags.length; index++) {\r\n          styles += tags[index] + (fns[index] ? fns[index](props) : '');\r\n        }\r\n        insertStyleAndSetclassIDs(\r\n          classID,\r\n          mainRule(styles, classID),\r\n          rulesForComponent,\r\n          classIDs,\r\n          cb\r\n        );\r\n        var rulesPseudoSelector = pseudoSelectorRules(styles, classID);\r\n        for (var index = 0; index < rulesPseudoSelector.length; index++) {\r\n          insertStyleAndSetclassIDs(\r\n            classID,\r\n            rulesPseudoSelector[index],\r\n            rulesForComponent,\r\n            classIDs,\r\n            cb\r\n          );\r\n        }\r\n        var rulesAt = atRules(styles, classID);\r\n        for (var index = 0; index < rulesAt.length; index++) {\r\n          insertStyleAndSetclassIDs(classID, rulesAt[index], rulesForComponent, classIDs, cb);\r\n        }\r\n        if (rulesForComponent[classID].length === 0) {\r\n          delete rulesForComponent[classID];\r\n        }\r\n        var attr = Object.assign({}, props);\r\n        attr.class = classIDs.join(' ') + ' ' + (props.class || props.className || '');\r\n        if (h.name === 'createElementWithValidation') {\r\n          attr.className = attr.class;\r\n          delete attr.class;\r\n          return h(elem, attr, children);\r\n        }\r\n        return h(elem, attr, children);\r\n      };\r\n    };\r\n  }\r\n  styled.keyframes = function(tags) {\r\n    var args = [].slice.call(arguments);\r\n    args.shift();\r\n    var styles = '';\r\n    for (var i = 0; i < tags.length; i++) {\r\n      styles += tags[i] + (args[i] || '');\r\n    }\r\n    var name = scoped.generateID();\r\n    cb('@keyframes ' + name + ' { ' + styles + ' }');\r\n    return name;\r\n  };\r\n  styled.global = function(tags) {\r\n    var args = [].slice.call(arguments);\r\n    args.shift();\r\n    var styles = '';\r\n    for (var i = 0; i < tags.length; i++) {\r\n      styles += tags[i] + (args[i] || '');\r\n    }\r\n    var matches = globalRules(styles);\r\n    for (var j = 0; j < matches.length; j++) {\r\n      cb(matches[j]);\r\n    }\r\n  };\r\n  return styled;\r\n}\r\n\r\nscoped.generateID = isTestEnvironment() ? generateIDForTests : generateID;\r\n\r\nscoped.defaultCallback = defaultcb;\r\n\r\nexport default scoped;\r\n"],"names":["pseudoSelectorRegex","atRuleRegex","globalRuleRegex","globalAtRuleRegex","bodyRuleRegex","commentRegex","testClassNamesIDCount","insertStyleAndSetclassIDs","classID","rule","rulesForComponent","classIDs","cb","nameRuleAlreadyExist","objkeysRulesForComponent","Object","keys","index","length","j","replace","ruleAlreadyExist","indexOf","push","sheet","document","insertRule","head","appendChild","createElement","defaultcb","css","cssRules","scoped","h","styled","elem","tags","fns","slice","call","arguments","shift","props","children","generateID","Array","isArray","styles","rulesPseudoSelector","rules","matches","match","ruleBody","pseudoSelectors","split","trim","pseudoSelectorRules","rulesAt","atrules","body","pseudoSelectorMatches","k","atRules","attr","assign","class","join","className","name","keyframes","args","i","global","concat","process","env","NODE_ENV","charSet","randomString","randomPoz","Math","floor","random","substring","defaultCallback"],"mappings":"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"}